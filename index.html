<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Happy Birthday, Muthiya!</title>

  <!-- =========================
       Open Graph / Sharing Preview
       ========================= -->
  <meta name="description" content="Happy Birthday, Muthiya! A small page made with love by Candra. ‚ù§Ô∏è">

  <link rel="canonical" href="https://tanjoubi-omedetou-muthiya.netlify.app/">
  <meta property="og:title" content="Happy Birthday, Muthiya! üéÇ‚ù§Ô∏è">
  <meta property="og:description" content="A small page made with love by Candra. Tap to open the surprise.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://tanjoubi-omedetou-muthiya.netlify.app/">

  <!-- Reliable OG image (exists now) -->
  <meta property="og:image" content="https://raw.githubusercontent.com/adityacandra02/birthday-2025/main/Muthiya.jpg">
  <meta property="og:image:alt" content="Happy Birthday, Muthiya!">
  <!-- Optional: if you add /og-image.jpg (1200x630) to the repo root, you can switch twitter:image + make this primary -->
  <meta property="og:image" content="https://tanjoubi-omedetou-muthiya.netlify.app/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Happy Birthday, Muthiya! üéÇ‚ù§Ô∏è">
  <meta name="twitter:description" content="A small page made with love by Candra. Tap to open the surprise.">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/adityacandra02/birthday-2025/main/Muthiya.jpg">
  <meta name="twitter:image:alt" content="Happy Birthday, Muthiya!">

  <meta name="theme-color" content="#000000">

  <style>
    :root{
      --bg1:#000000;
      --bg2:#333333;
      --card: rgba(0,0,0,0.55);
      --border: rgba(255,255,255,0.18);
      --accent: #f39c12;
      --accent2:#d35400;
      --soft: rgba(255,255,255,0.08);
    }

    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(45deg, var(--bg1), var(--bg2));
      color: #fff;
      margin: 0;
      padding: 0;
      overflow: hidden; /* locked during intro */
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .pixel-animation-container, .balloon-container, #main-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .pixel-animation-container {
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }

    .character-image {
      width: 150px;
      height: auto;
      display: none;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .dialogue-box {
      font-size: 1.5rem;
      color: white;
      font-family: monospace;
      background: rgba(0, 0, 0, 0.8);
      padding: 10px;
      border: 2px solid white;
      width: 80%;
      text-align: center;
      margin-bottom: 20px;
      cursor: pointer;
      user-select: none;
    }

    .balloon-container {
      background: rgba(0, 0, 0, 0.9);
      flex-wrap: wrap;
      z-index: 500;
      display: none;
    }

    .balloon {
      font-size: 2rem;
      color: white;
      position: absolute;
      opacity: 0;
      animation: fadeInUp 5s ease-out forwards, floatUp 10s linear infinite, rotateBalloon 7s ease-in-out infinite;
    }

    .balloon.last {
      animation: expandBalloon 3s ease-out forwards;
      font-size: 4rem;
      z-index: 1000;
      opacity: 1;
    }

    @keyframes expandBalloon {
      from { transform: scale(1); opacity: 1; }
      to { transform: scale(3); opacity: 0.5; }
    }

    #main-content {
      display: none;
      justify-content: flex-start;
      padding: 20px 16px 40px;
      overflow-y: auto; /* allow scroll when content is tall */
    }

    body.main-shown { overflow: hidden; } /* main-content handles scrolling */

    .scroll-text {
      font-size: 2rem;
      font-weight: bold;
      color: #fff;
      position: absolute;
      animation: appearBig 5s ease-out forwards;
      display: none;
      z-index: 600;
      padding: 0 12px;
    }

    @keyframes appearBig {
      0% { transform: scale(1); opacity: 0; }
      50% { transform: scale(3); opacity: 1; }
      100% { transform: scale(5); opacity: 0; }
    }

    /* ===== Main Layout ===== */
    .page {
      width: min(980px, 92vw);
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: center;
    }

    .hero {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px 16px;
      box-shadow: 0 0 18px rgba(0,0,0,0.6);
    }

    h1 {
      margin: 0 0 8px;
      font-size: clamp(1.8rem, 3.6vw, 2.6rem);
      letter-spacing: 0.5px;
    }

    .sub {
      margin: 0;
      opacity: 0.9;
      line-height: 1.5;
      font-size: 1.05rem;
    }

    .video-container{
      width: min(640px, 92vw);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
      box-shadow: 0 0 18px rgba(0,0,0,0.55);
      background: rgba(0,0,0,0.35);
    }

    .video-container iframe{
      width: 100%;
      aspect-ratio: 16 / 9;
      height: auto;
      border: 0;
      display:block;
    }

    .section {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 0 14px rgba(0,0,0,0.45);
    }

    .section h2{
      margin: 0 0 10px;
      font-size: 1.25rem;
      letter-spacing: 0.3px;
    }

    .message p{
      margin: 10px 0;
      line-height: 1.65;
      font-size: 1.05rem;
    }

    /* ===== Music Control ===== */
    .music-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      margin-top: 8px;
    }

    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.08);
      color: #fff;
      padding: 10px 14px;
      border-radius: 999px;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.12); }
    .btn:active{ transform: translateY(0px) scale(0.98); }

    /* ===== Gift ===== */
    .gift-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 8px;
      gap: 12px;
    }

    .gift-box {
      width: 120px;
      height: 120px;
      background: linear-gradient(45deg, var(--accent), var(--accent2));
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.8);
      transition: transform .2s ease;
    }
    .gift-box:hover{ transform: translateY(-2px) rotate(-1deg); }

    .coupon {
      display: none;
      margin-top: 4px;
      color: #fff;
      background: rgba(0, 0, 0, 0.55);
      padding: 16px;
      border-radius: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.25);
      line-height: 1.5;
      width: min(680px, 92vw);
      position: relative;
      overflow: hidden;
      text-align: left;
    }

    /* ===== Redeemable Ticket Styles ===== */
    .ticket-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding-bottom: 12px;
      border-bottom: 1px dashed rgba(255,255,255,0.22);
      margin-bottom: 12px;
    }
    .ticket-title{
      font-weight: 800;
      letter-spacing: .3px;
      font-size: 1.1rem;
    }
    .ticket-badge{
      font-size: .9rem;
      padding: 6px 10px;
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      opacity: .95;
      white-space: nowrap;
    }

    .ticket-items{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .ticket-item{
      position: relative;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }

    .ticket-left{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      flex: 1;
      min-width: 0;
    }

    .check{
      width: 22px;
      height: 22px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(0,0,0,0.25);
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
      margin-top: 2px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2) inset;
    }

    .check span{
      opacity: 0;
      transform: scale(0.8);
      transition: opacity .2s ease, transform .2s ease;
    }

    .ticket-text{
      min-width: 0;
    }

    .ticket-text .main{
      font-weight: 700;
      margin: 0;
    }

    .ticket-text .sub{
      margin: 4px 0 0;
      opacity: .88;
      font-size: .95rem;
      line-height: 1.4;
    }

    .redeem-btn{
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: #fff;
      padding: 9px 12px;
      border-radius: 999px;
      cursor: pointer;
      transition: transform .15s ease, background .15s ease;
      user-select:none;
      flex: 0 0 auto;
      white-space: nowrap;
    }
    .redeem-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.12); }
    .redeem-btn:active{ transform: translateY(0px) scale(0.98); }

    .ticket-item.redeemed{
      opacity: 0.95;
      border-color: rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.05);
    }

    .ticket-item.redeemed .check span{
      opacity: 1;
      transform: scale(1);
    }

    .stamp{
      position:absolute;
      right: 12px;
      top: 10px;
      transform: rotate(-18deg) scale(0.6);
      opacity: 0;
      pointer-events:none;
      border: 2px solid rgba(255, 90, 90, 0.85);
      color: rgba(255, 90, 90, 0.95);
      padding: 6px 10px;
      border-radius: 10px;
      font-weight: 900;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: rgba(0,0,0,0.15);
      text-shadow: 0 0 10px rgba(255,90,90,0.18);
    }

    .ticket-item.redeemed .stamp{
      opacity: 1;
      animation: stampPop .35s ease-out;
      transform: rotate(-18deg) scale(1);
    }

    @keyframes stampPop {
      0% { transform: rotate(-18deg) scale(0.6); opacity: 0; }
      70% { transform: rotate(-18deg) scale(1.08); opacity: 1; }
      100% { transform: rotate(-18deg) scale(1); opacity: 1; }
    }

    .ticket-footer{
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed rgba(255,255,255,0.22);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
      opacity: .92;
    }

    .tiny-link{
      cursor:pointer;
      opacity: .85;
      text-decoration: underline;
    }

    /* =========================
       PREMIUM FEATURE 1: Timeline
       ========================= */
    .timeline {
      position: relative;
      margin: 10px auto 0;
      padding-left: 18px;
      max-width: 820px;
      text-align:left;
    }
    .timeline:before{
      content:"";
      position:absolute;
      left: 8px;
      top: 6px;
      bottom: 6px;
      width: 2px;
      background: rgba(255,255,255,0.18);
    }
    .tl-item{
      position:relative;
      padding: 12px 12px 12px 18px;
      margin: 10px 0;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .55s ease, transform .55s ease;
    }
    .tl-item.visible{ opacity: 1; transform: translateY(0); }
    .tl-item:before{
      content:"";
      position:absolute;
      left: -2px;
      top: 18px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(243,156,18,0.9);
      box-shadow: 0 0 10px rgba(243,156,18,0.35);
    }
    .tl-year{
      font-weight: bold;
      opacity: .95;
      margin-bottom: 4px;
    }
    .tl-text{
      margin:0;
      opacity: .92;
      line-height: 1.55;
    }

    /* =========================
       PREMIUM FEATURE 2: Open-When Letters
       ========================= */
    .letters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .letter {
      position: relative;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      padding: 14px;
      cursor: pointer;
      transition: transform .18s ease, background .18s ease;
      overflow: hidden;
      user-select:none;
      text-align:left;
    }
    .letter:hover{ transform: translateY(-2px); background: rgba(255,255,255,0.09); }

    .letter .topline{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 8px;
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    .seal{
      font-size: 1.2rem;
      opacity: .9;
    }
    .letter .hint{
      margin: 8px 0 0;
      opacity: .85;
      font-size: .95rem;
      line-height: 1.45;
    }
    .letter .content{
      margin-top: 10px;
      display:none;
      border-top: 1px dashed rgba(255,255,255,0.18);
      padding-top: 10px;
      line-height: 1.55;
      opacity: .95;
    }
    .letter.open .content{ display:block; }

    /* =========================
       PREMIUM FEATURE 3: Reunion Countdown
       ========================= */
    .countdown-wrap{
      display:flex;
      flex-direction:column;
      gap: 10px;
      align-items:center;
      margin-top: 8px;
    }
    .countdown-grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(70px, 1fr));
      gap: 10px;
      width: min(520px, 92vw);
    }
    .cd-card{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 10px 8px;
    }
    .cd-num{
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: 0.4px;
    }
    .cd-lab{
      margin-top: 2px;
      opacity: .85;
      font-size: .9rem;
    }
    .cd-note{
      opacity: .9;
      line-height: 1.55;
      margin: 0;
      max-width: 820px;
    }

    .footer {
      margin-top: 6px;
      opacity: 0.85;
      font-size: 0.95rem;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(100px); }
      to { opacity: 1; transform: translateY(-50px); }
    }
    @keyframes floatUp {
      from { transform: translateY(0px); }
      to { transform: translateY(-200px); }
    }
    @keyframes rotateBalloon {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(5deg); }
    }

    @media (max-width: 520px){
      .dialogue-box{ font-size: 1.1rem; }
      .scroll-text{ font-size: 1.4rem; }
    }
  </style>
</head>

<body>
  <!-- Pixel Animation Section -->
  <div id="pixel-animation" class="pixel-animation-container">
    <img id="candra-image" class="character-image" src="https://raw.githubusercontent.com/adityacandra02/birthday-2025/main/Candra.jpg" alt="Candra">
    <img id="muthiya-image" class="character-image" src="https://raw.githubusercontent.com/adityacandra02/birthday-2025/main/Muthiya.jpg" alt="Muthiya">
    <div class="dialogue-box" id="pixel-text">Click to continue...</div>
  </div>

  <!-- Balloon Animation Section -->
  <div id="balloon-container" class="balloon-container"></div>

  <!-- Text Animation -->
  <div id="scroll-text" class="scroll-text">„É†„ÉÜ„Ç£„É§„ÄÅ33Ê≠≥„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅüéâ</div>

  <!-- Main Content Section -->
  <div id="main-content">
    <div class="page">

      <div class="hero">
        <h1>Stay young, Muthiya! üéâ</h1>
        <p class="sub">A tiny corner of the internet made just for you ‚Äî from Candra, always. ‚ù§Ô∏è</p>

        <div class="music-row" style="margin-top:12px;">
          <button class="btn" id="music-btn">‚ñ∂Ô∏è Play music</button>
          <button class="btn" id="share-btn">üîó Copy link</button>
        </div>
        <p class="sub" id="share-status" style="margin-top:10px; opacity:.85;"></p>
      </div>

      <div class="video-container" aria-label="Birthday video">
        <iframe
          src="https://www.youtube.com/embed/PkAcfOKi1KI"
          title="Birthday Video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      </div>

      <div class="section message">
        <h2>For you, bebe üíå</h2>
        <p>
          Happy birthday, my love. Since October 2019, we‚Äôve been loving each other across Indonesia and Japan.
          It wasn‚Äôt easy ‚Äî and that‚Äôs exactly why I‚Äôm proud of us.
        </p>
        <p>
          <b>33 is not older. It‚Äôs stronger.</b> And you are the strongest person I know.
        </p>
        <p>
          March in Indonesia, April in Japan‚Ä¶ we‚Äôre almost at the part we‚Äôve been waiting for. ‚ù§Ô∏è
        </p>
      </div>

      <!-- PREMIUM 1: Our Story Timeline -->
      <div class="section">
        <h2>Our story (so far) ‚ú®</h2>
        <div class="timeline" id="timeline">
          <div class="tl-item">
            <div class="tl-year">October 2019 üíç</div>
            <p class="tl-text">We got married ‚Äî and promised to build a life, even across countries.</p>
          </div>

          <div class="tl-item">
            <div class="tl-year">2019 ‚Üí 2025 (Indonesia ‚Üî Japan)</div>
            <p class="tl-text">Long-distance became our normal: calls, patience, short visits, and a lot of love.</p>
          </div>

          <div class="tl-item">
            <div class="tl-year">March 2026 üáÆüá©</div>
            <p class="tl-text">I‚Äôm coming to Indonesia to pick you up ‚Äî not just for a trip, but for our next chapter.</p>
          </div>

          <div class="tl-item">
            <div class="tl-year">April 2026 üáØüáµ</div>
            <p class="tl-text">We start our daily life together in Japan ‚Äî no more screens for ‚Äúgoodnight.‚Äù</p>
          </div>
        </div>
      </div>

      <!-- PREMIUM 2: Open-When Letters -->
      <div class="section">
        <h2>Open when‚Ä¶ üíñ</h2>
        <p style="margin:0; opacity:.9;">Tap a letter. I wrote these for the days you need them.</p>
        <div class="letters" id="letters">
          <div class="letter" data-letter="1">
            <div class="topline">
              <span>‚Ä¶work feels too heavy</span>
              <span class="seal">üíå</span>
            </div>
            <p class="hint">For the days you carry too much.</p>
            <div class="content">
              <p style="margin:0;">
                Bebe, breathe. You don‚Äôt have to be strong every second.
                If today is hard, let it be hard ‚Äî and let it pass.
                I‚Äôm proud of you, and I‚Äôm here. Always.
              </p>
            </div>
          </div>

          <div class="letter" data-letter="2">
            <div class="topline">
              <span>‚Ä¶you feel scared of getting older</span>
              <span class="seal">üïäÔ∏è</span>
            </div>
            <p class="hint">A small truth: you‚Äôre more beautiful with time.</p>
            <div class="content">
              <p style="margin:0;">
                Listen to me: you are not ‚Äúless‚Äù because time moves.
                You are more beautiful because you‚Äôve lived, learned, and loved.
                33 looks soft and powerful on you. I love you.
              </p>
            </div>
          </div>

          <div class="letter" data-letter="3">
            <div class="topline">
              <span>‚Ä¶you miss ‚Äúus‚Äù</span>
              <span class="seal">üåô</span>
            </div>
            <p class="hint">For when distance feels loud.</p>
            <div class="content">
              <p style="margin:0;">
                Imagine I‚Äôm holding your hand right now.
                The distance is temporary ‚Äî our life is not.
                We‚Äôre almost at the part where we wake up in the same place.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- PREMIUM 3: Reunion Countdown -->
      <div class="section">
        <h2>Countdown to ‚Äútogether‚Äù üóìÔ∏è‚ù§Ô∏è</h2>
        <div class="countdown-wrap">
          <div class="countdown-grid" id="countdown">
            <div class="cd-card">
              <div class="cd-num" id="cd-days">--</div>
              <div class="cd-lab">Days</div>
            </div>
            <div class="cd-card">
              <div class="cd-num" id="cd-hours">--</div>
              <div class="cd-lab">Hours</div>
            </div>
            <div class="cd-card">
              <div class="cd-num" id="cd-mins">--</div>
              <div class="cd-lab">Minutes</div>
            </div>
            <div class="cd-card">
              <div class="cd-num" id="cd-secs">--</div>
              <div class="cd-lab">Seconds</div>
            </div>
          </div>
          <p class="cd-note" id="countdown-note">
            First: I‚Äôm coming to Indonesia in March to pick you up. üáÆüá©
            Then: we start our life together in Japan this April. üáØüáµ‚ù§Ô∏è
          </p>
        </div>
      </div>

      <!-- Gift Reveal Section -->
      <div class="section">
        <h2>One more surprise üéÅ</h2>
        <div class="gift-container">
          <div id="gift-box" class="gift-box" role="button" aria-label="Open gift">üéÅ</div>

          <!-- Redeemable ticket coupon -->
          <div id="coupon" class="coupon" aria-live="polite">
            <div class="ticket-top">
              <div class="ticket-title">Birthday Special Coupon üéüÔ∏è</div>
              <div class="ticket-badge">Valid for Muthiya only üíñ</div>
            </div>

            <div class="ticket-items" id="ticket-items">
              <div class="ticket-item" data-redeem="sushiro">
                <div class="ticket-left">
                  <div class="check" aria-hidden="true"><span>‚úî</span></div>
                  <div class="ticket-text">
                    <p class="main" style="margin:0;">Unlimited eating at üç£ Sushiro üç£</p>
                    <p class="sub">Valid only on your birthday üòâ</p>
                  </div>
                </div>
                <button class="redeem-btn" type="button">Stamp</button>
                <div class="stamp">REDEEMED</div>
              </div>

              <div class="ticket-item" data-redeem="carrotcake">
                <div class="ticket-left">
                  <div class="check" aria-hidden="true"><span>‚úî</span></div>
                  <div class="ticket-text">
                    <p class="main" style="margin:0;">Special carrot cake ü•ïüç∞ made by me</p>
                    <p class="sub">When we start living together in Japan üáØüáµ‚ù§Ô∏è</p>
                  </div>
                </div>
                <button class="redeem-btn" type="button">Stamp</button>
                <div class="stamp">REDEEMED</div>
              </div>
            </div>

            <div class="ticket-footer">
              <span style="opacity:.92;">Tip: tap ‚ÄúStamp‚Äù to redeem (it stays saved).</span>
              <span class="tiny-link" id="reset-ticket">Reset ticket</span>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <p>Made with ‚ù§Ô∏è by Candra</p>
      </div>
    </div>
  </div>

  <!-- Audio element for the MP3 file -->
  <audio id="birthday-audio" src="https://raw.githubusercontent.com/adityacandra02/birthday-2025/main/otanjoubi%20omedetou.mp3" loop></audio>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const pixelText = document.getElementById("pixel-text");
      const candraImage = document.getElementById("candra-image");
      const muthiyaImage = document.getElementById("muthiya-image");
      const balloonContainer = document.getElementById("balloon-container");
      const pixelAnimation = document.getElementById("pixel-animation");
      const mainContent = document.getElementById("main-content");
      const scrollText = document.getElementById("scroll-text");
      const birthdayAudio = document.getElementById("birthday-audio");
      const giftBox = document.getElementById("gift-box");
      const coupon = document.getElementById("coupon");

      // Controls
      const musicBtn = document.getElementById("music-btn");
      const shareBtn = document.getElementById("share-btn");
      const shareStatus = document.getElementById("share-status");

      // Premium nodes
      const letters = document.getElementById("letters");
      const timelineItems = document.querySelectorAll(".tl-item");

      // Ticket nodes
      const ticketItems = document.getElementById("ticket-items");
      const resetTicketBtn = document.getElementById("reset-ticket");

      // ===== SETTINGS =====
      const AGE = 33;

      // Together in Japan starts in April (edit day/time if you know exact arrival/move-in)
      const REUNION_DATE = "2026-04-01T09:00:00+09:00";

      const cdDays = document.getElementById("cd-days");
      const cdHours = document.getElementById("cd-hours");
      const cdMins = document.getElementById("cd-mins");
      const cdSecs = document.getElementById("cd-secs");
      const cdNote = document.getElementById("countdown-note");

      function ordinal(n) {
        const s = ["th", "st", "nd", "rd"];
        const v = n % 100;
        return n + (s[(v - 20) % 10] || s[v] || s[0]);
      }

      const dialogue = [
        { speaker: "Candra", text: "Hey Muthiya üòÑ" },
        { speaker: "Muthiya", text: "Candra‚Ä¶ you know what day it is." },
        { speaker: "Candra", text: `Of course. Happy ${ordinal(AGE)} birthday, bebe! üéÇ‚ú®` },
        { speaker: "Muthiya", text: `${AGE}‚Ä¶ sounds too real üò≠` },
        { speaker: "Candra", text: "Real, yes. But also: more glow, more calm, more power." },
        { speaker: "Muthiya", text: "You always say that üòÇ" },
        { speaker: "Candra", text: "Because it‚Äôs true. And this year is different." },
        { speaker: "Muthiya", text: "Different how?" },
        { speaker: "Candra", text: "Since October 2019, we‚Äôve been doing Indonesia‚ÄìJapan long-distance." },
        { speaker: "Muthiya", text: "Yeah‚Ä¶ we really did." },
        { speaker: "Candra", text: "And now we‚Äôre closing the distance for real." },
        { speaker: "Muthiya", text: "Don‚Äôt tease me üëÄ" },
        { speaker: "Candra", text: "March: I come to Indonesia to pick you up. üáÆüá©" },
        { speaker: "Muthiya", text: "‚Ä¶Okay I‚Äôm emotional now." },
        { speaker: "Candra", text: "April: we start our life together in Japan. Finally. üáØüáµ‚ù§Ô∏è" }
      ];

      let index = 0;

      // Click to advance dialogue
      pixelText.addEventListener("click", () => {
        if (index < dialogue.length) {
          const line = dialogue[index];
          pixelText.innerText = line.text;

          if (line.speaker === "Candra") {
            candraImage.style.display = "block";
            muthiyaImage.style.display = "none";
          } else {
            muthiyaImage.style.display = "block";
            candraImage.style.display = "none";
          }
          index++;
        } else {
          pixelAnimation.style.display = "none";
          startBalloonAnimation();
        }
      });

      function startBalloonAnimation() {
        balloonContainer.style.display = "flex";
        balloonContainer.innerHTML = ""; // prevent duplicates

        for (let i = 1; i <= AGE; i++) {
          setTimeout(() => {
            const balloon = document.createElement("div");
            balloon.classList.add("balloon");
            if (i === AGE) balloon.classList.add("last");
            balloon.textContent = i;
            balloon.style.left = `${Math.random() * 80 + 10}%`;
            balloon.style.top = `${Math.random() * 80 + 10}%`;
            balloonContainer.appendChild(balloon);

            // Ensure the LAST balloon expands (not hardcoded)
            if (i === AGE) {
              setTimeout(() => {
                balloon.style.animation = "expandBalloon 3s ease-out forwards";
              }, 1000);
            }
          }, i * 200);
        }

        setTimeout(() => {
          balloonContainer.style.display = "none";
          showScrollText();
        }, 18000);
      }

      function showScrollText() {
        scrollText.style.display = "block";
        setTimeout(() => {
          scrollText.style.display = "none";
          showMainContent();
        }, 5000);
      }

      function showMainContent() {
        mainContent.style.display = "flex";
        document.body.classList.add("main-shown");

        birthdayAudio.play().catch(() => { /* autoplay may be blocked */ });

        setupTimelineReveal();
        startCountdown();
      }

      // Gift open => show ticket coupon
      giftBox.addEventListener("click", () => {
        giftBox.style.display = "none";
        coupon.style.display = "block";
        restoreTicketRedemptions();
      });

      // Music button
      let musicOn = false;
      musicBtn.addEventListener("click", async () => {
        try {
          if (!musicOn) {
            await birthdayAudio.play();
            musicOn = true;
            musicBtn.textContent = "‚è∏Ô∏è Pause music";
          } else {
            birthdayAudio.pause();
            musicOn = false;
            musicBtn.textContent = "‚ñ∂Ô∏è Play music";
          }
        } catch (e) {}
      });

      // Copy link
      shareBtn.addEventListener("click", async () => {
        const url = window.location.href;
        try {
          await navigator.clipboard.writeText(url);
          shareStatus.textContent = "Copied! Send it to Muthiya üíñ";
          setTimeout(() => (shareStatus.textContent = ""), 2500);
        } catch (e) {
          shareStatus.textContent = "Couldn‚Äôt copy automatically. Long-press the address bar to copy.";
          setTimeout(() => (shareStatus.textContent = ""), 3500);
        }
      });

      // Letters memory
      letters.addEventListener("click", (e) => {
        const card = e.target.closest(".letter");
        if (!card) return;
        card.classList.toggle("open");

        const id = card.getAttribute("data-letter");
        const key = `letter_open_${id}`;
        const isOpen = card.classList.contains("open");
        try { localStorage.setItem(key, isOpen ? "1" : "0"); } catch (_) {}
      });

      function restoreLetters() {
        document.querySelectorAll(".letter").forEach((card) => {
          const id = card.getAttribute("data-letter");
          const key = `letter_open_${id}`;
          try {
            if (localStorage.getItem(key) === "1") card.classList.add("open");
          } catch (_) {}
        });
      }

      // Timeline reveal
      function setupTimelineReveal(){
        const obs = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) entry.target.classList.add("visible");
          });
        }, { threshold: 0.15 });

        timelineItems.forEach((el) => obs.observe(el));
      }

      // Countdown
      function startCountdown(){
        const target = new Date(REUNION_DATE).getTime();
        if (Number.isNaN(target)) {
          cdNote.textContent = "Set REUNION_DATE in the code to start the countdown ‚ú®";
          return;
        }

        const tick = () => {
          const now = Date.now();
          let diff = target - now;

          if (diff <= 0) {
            cdDays.textContent = "0";
            cdHours.textContent = "0";
            cdMins.textContent = "0";
            cdSecs.textContent = "0";
            cdNote.textContent = "It‚Äôs time. Come here, bebe. ‚ù§Ô∏è";
            return;
          }

          const sec = Math.floor(diff / 1000);
          const days = Math.floor(sec / 86400);
          const hours = Math.floor((sec % 86400) / 3600);
          const mins = Math.floor((sec % 3600) / 60);
          const secs = sec % 60;

          cdDays.textContent = String(days);
          cdHours.textContent = String(hours).padStart(2, "0");
          cdMins.textContent = String(mins).padStart(2, "0");
          cdSecs.textContent = String(secs).padStart(2, "0");

          setTimeout(tick, 1000);
        };

        tick();
      }

      // ===== Ticket (redeem + stamp) =====
      function ticketKey(id){ return `ticket_redeemed_${id}`; }

      function setRedeemed(el, redeemed){
        el.classList.toggle("redeemed", redeemed);
        const id = el.getAttribute("data-redeem");
        try { localStorage.setItem(ticketKey(id), redeemed ? "1" : "0"); } catch (_) {}
      }

      function restoreTicketRedemptions(){
        if (!ticketItems) return;
        ticketItems.querySelectorAll(".ticket-item").forEach((item) => {
          const id = item.getAttribute("data-redeem");
          try {
            const saved = localStorage.getItem(ticketKey(id)) === "1";
            setRedeemed(item, saved);
          } catch (_) {}
        });
      }

      // Click "Stamp" to toggle redeemed
      ticketItems.addEventListener("click", (e) => {
        const btn = e.target.closest(".redeem-btn");
        if (!btn) return;
        const item = e.target.closest(".ticket-item");
        if (!item) return;

        const isRedeemed = item.classList.contains("redeemed");
        setRedeemed(item, !isRedeemed);
        btn.textContent = !isRedeemed ? "Unstamp" : "Stamp";
      });

      // Reset ticket
      resetTicketBtn.addEventListener("click", () => {
        ticketItems.querySelectorAll(".ticket-item").forEach((item) => {
          const id = item.getAttribute("data-redeem");
          try { localStorage.removeItem(ticketKey(id)); } catch (_) {}
          item.classList.remove("redeemed");
          const b = item.querySelector(".redeem-btn");
          if (b) b.textContent = "Stamp";
        });
      });

      // Restore letter open states immediately
      restoreLetters();

      // Start the dialogue system (show first line immediately)
      const first = dialogue[0];
      pixelText.innerText = first.text;
      candraImage.style.display = "block";
      muthiyaImage.style.display = "none";
      index = 1;
    });
  </script>
</body>
</html>
